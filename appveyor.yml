version: 1.0.{build}
image: Visual Studio 2019 Preview
skip_tags: true

before_build:
- cd src
- dotnet restore
- choco install opencover.portable
- choco install codecov
  
build:
project: DiscordBot.sln
verbosity: minimal
  
dotnet_csproj:
  patch: true
  file: '**\*.csproj'
  version: '{version}'
  package_version: '{version}'

build_script:
    - dotnet build src -c Release
  
test_script:
- dotnet test src
- OpenCover.Console.exe -register:user -target:"C:/Program Files/dotnet/dotnet.exe" -targetargs:test -filter:"+[DiscordBot.Core*]* -[DiscordBot.xUnit.Tests*]*" -output:".\MyProject_coverage.xml" -oldstyle
- codecov -f "MyProject_coverage.xml